(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{40534:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/prompt",function(){return n(88120)}])},88120:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(85893),a=n(67294),s=n(83062),o=n(42075),l=n(2453),i=n(82610),c=n(71577),p=n(61607),m=n(39479),d=n(12069),u=n(75081),_=n(59566),h=n(30119),P=n(67421),f=e=>{let{children:t,prompt_type:n,item:s,mutate:o,setTableParams:i,pageSize:p}=e,{t:f}=(0,P.$G)(),[x,j]=(0,a.useState)(!1),[g,Z]=(0,a.useState)(!1),[I]=m.Z.useForm(),b=()=>{j(!1),I.resetFields()},v=async()=>{try{let e=I.getFieldsValue(),t={prompt_type:n,...e};if(Z(!0),s){let n=await (0,h.PR)("/prompt/update",t);n.success?(o(t=>{let{data:n}=t;return{data:n.map(t=>t.prompt_name===s.prompt_name?{...t,...e}:t)}}),l.ZP.success(f("Edit_Success")),Z(!1),j(!1)):(Z(!1),l.ZP.error(null==n?void 0:n.err_msg))}else{let e=await (0,h.PR)("/prompt/add",t);e.success?(o(e=>{let{data:n}=e,r=n.length>=p?n.slice(0,-1):n;return{data:[t,...r]}}),i(e=>({...e,pagination:{...e.pagination,total:e.pagination.total+1}})),l.ZP.success(f("Add_Success")),Z(!1),j(!1)):(Z(!1),l.ZP.error(null==e?void 0:e.err_msg))}}catch(e){Z(!1),console.error(e),l.ZP.error(f("Error_Message"))}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"inline-block",onClick:()=>{j(!0),s&&I.setFieldsValue(s)},children:t}),(0,r.jsx)(d.default,{title:s?f("Edit")+" Prompts":f("Add")+" Prompts",open:x,onCancel:b,footer:null,children:(0,r.jsx)(u.Z,{spinning:g,children:(0,r.jsxs)(m.Z,{form:I,name:"prompt-item-".concat((null==s?void 0:s.prompt_name)||"new"),labelCol:{span:4},wrapperCol:{span:20},onFinish:v,children:[(0,r.jsx)(m.Z.Item,{name:"chat_scene",label:f("Prompt_Info_Scene"),rules:[{required:!0,message:f("Please_Input")+f("Prompt_Info_Scene")}],children:(0,r.jsx)(_.default,{})}),(0,r.jsx)(m.Z.Item,{name:"sub_chat_scene",label:f("Prompt_Info_Sub_Scene"),rules:[{required:!0,message:f("Please_Input")+f("Prompt_Info_Sub_Scene")}],children:(0,r.jsx)(_.default,{})}),(0,r.jsx)(m.Z.Item,{name:"prompt_name",label:f("Prompt_Info_Name"),rules:[{required:!0,message:f("Please_Input")+f("Prompt_Info_Name")}],children:(0,r.jsx)(_.default,{disabled:!!s})}),(0,r.jsx)(m.Z.Item,{name:"content",label:f("Prompt_Info_Content"),rules:[{required:!0,message:f("Please_Input")+f("Prompt_Info_Content")}],children:(0,r.jsx)(_.default.TextArea,{rows:6})}),(0,r.jsxs)(m.Z.Item,{wrapperCol:{offset:15,span:10},children:[(0,r.jsx)(c.ZP,{onClick:b,className:"mr-2",children:f("cancel")}),(0,r.jsx)(c.ZP,{type:"primary",htmlType:"submit",children:f("submit")})]})]})})})]})},x=n(24969),j=n(27547),g=n(15398),Z=n(577),I=()=>{let{t:e}=(0,P.$G)(),t=[{label:e("Public")+" Prompts",key:"common",icon:(0,r.jsx)(j.Z,{})},{label:e("Private")+" Prompts",key:"private",icon:(0,r.jsx)(g.Z,{})}],n=(t,n)=>[{title:e("Prompt_Info_Name"),dataIndex:"prompt_name",key:"prompt_name"},{title:e("Prompt_Info_Scene"),dataIndex:"chat_scene",key:"chat_scene"},{title:e("Prompt_Info_Sub_Scene"),dataIndex:"sub_chat_scene",key:"sub_chat_scene"},{title:e("Prompt_Info_Content"),dataIndex:"content",key:"content",render:e=>(0,r.jsx)(s.Z,{placement:"topLeft",title:e,children:e})},{title:e("Operation"),dataIndex:"operate",key:"operate",render:(a,s)=>(0,r.jsx)(o.Z,{size:"middle",children:(0,r.jsx)(f,{prompt_type:t,item:s,mutate:n,children:(0,r.jsx)("a",{children:e("Edit")})})})}],[m,d]=(0,a.useState)("common"),[u,_]=(0,a.useState)({pagination:{current:1,pageSize:1e3,hideOnSinglePage:!0,showQuickJumper:!0,showTotal:(e,t)=>"第 ".concat(t[0],"-").concat(t[1]," 条，共 ").concat(e," 条")}}),{data:I,loading:b,run:v,mutate:S}=(0,Z.Z)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,n={prompt_type:t,...e.pagination};return(0,h.PR)("/prompt/list",n)},{onSuccess:e=>{_(t=>{var n;return{...t,pagination:{...t.pagination,total:(null==e?void 0:e.totalCount)||(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.length)}}})},onError:e=>{l.ZP.error(null==e?void 0:e.message)}}),y=(0,a.useMemo)(()=>n(m,S),[m,S]);return(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Z,{onClick:e=>{let t=e.key;d(t),v(u,t)},selectedKeys:[m],mode:"horizontal",items:t}),(0,r.jsxs)("div",{className:"px-6 py-4",children:[(0,r.jsxs)("div",{className:"flex flex-row-reverse mb-4",children:[(0,r.jsx)(f,{prompt_type:m,mutate:S,setTableParams:_,pageSize:u.pagination.pageSize,children:(0,r.jsxs)(c.ZP,{className:"flex items-center",children:[(0,r.jsx)(x.Z,{}),e("Add")," Prompts"]})}),"common"===m&&(0,r.jsxs)(c.ZP,{className:"mr-2 flex items-center",disabled:!0,children:[(0,r.jsx)(x.Z,{}),e("Add")," Prompts ",e("template")]})]}),(0,r.jsx)(p.Z,{columns:y,dataSource:null==I?void 0:I.data,loading:b,rowKey:e=>e.prompt_name,pagination:u.pagination,onChange:e=>{let t={...u,pagination:{...u.pagination,...e}};_(t),v(t,m)},scroll:{y:600}})]})]})}},30119:function(e,t,n){"use strict";n.d(t,{Tk:function(){return i},PR:function(){return c}});var r=n(2453),a=n(6154),s=n(83454);let o=a.Z.create({baseURL:s.env.API_BASE_URL});o.defaults.timeout=1e4,o.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),n(96486);let l={"content-type":"application/json"},i=(e,t)=>{if(t){let n=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");n&&(e+="?".concat(n))}return o.get("/api"+e,{headers:l}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})},c=(e,t)=>o.post(e,t,{headers:l}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[662,44,479,9,815,270,45,61,367,774,888,179],function(){return e(e.s=40534)}),_N_E=e.O()}]);