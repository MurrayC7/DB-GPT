"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{78543:function(e,t,l){l.d(t,{Z:function(){return y}});var s=l(85893),a=l(67294),n=l(12069),i=l(3363),r=l(67421),c=l(50489),o=l(39479),d=l(59566),m=l(71577);function u(e){let{t}=(0,r.$G)(),{handleAddKnowledge:l}=e,a=async e=>{let{knowledgeName:t,owner:s,description:a}=e,[n,i,r]=await (0,c.Vx)((0,c.U6)({name:t,vector_type:"Chroma",owner:s,desc:a}));(null==r?void 0:r.success)&&l()};return(0,s.jsxs)(o.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:a,children:[(0,s.jsx)(o.Z.Item,{label:t("Knowledge_Space_Name"),name:"knowledgeName",rules:[{required:!0,message:t("Please_input_the_name")},()=>({validator:(e,l)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(l)?Promise.reject(Error(t("the_name_can_only_contain"))):Promise.resolve()})],children:(0,s.jsx)(d.default,{className:"mb-5 h-12",placeholder:t("Please_input_the_name")})}),(0,s.jsx)(o.Z.Item,{label:t("Owner"),name:"owner",rules:[{required:!0,message:t("Please_input_the_owner")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_owner")})}),(0,s.jsx)(o.Z.Item,{label:t("Description"),name:"description",rules:[{required:!0,message:t("Please_input_the_description")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:t("Please_input_the_description")})}),(0,s.jsx)(o.Z.Item,{children:(0,s.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:t("Next")})})]})}var h=l(31365),x=l(2453),p=l(85813),_=l(72269),j=l(92039),f=l(64082);let b={ChooseType:1,AddDataSourceForm:2},{Dragger:g}=h.default;function Z(e){let{handleChooseType:t,documentType:l,step:a,handleBackBtn:n,knowledgeName:i,syncDocuments:u,fetchDocuments:Z,setIsAddShow:y}=e,{t:N}=(0,r.$G)(),[w]=o.Z.useForm(),{TextArea:k}=d.default,T=async e=>{var t;let s;let{synchChecked:a,documentName:n,textSource:r,originFileObj:o,text:d,webPageUrl:m}=e;switch(l){case"webPage":s=await (0,c.Vx)((0,c.H_)(i,{doc_name:n,content:m,doc_type:"URL"}));break;case"file":let h=new FormData;h.append("doc_name",n||o.file.name),h.append("doc_file",o.file),h.append("doc_type","DOCUMENT"),s=await (0,c.Vx)((0,c.iG)(i,h));break;default:s=await (0,c.Vx)((0,c.H_)(i,{doc_name:n,source:r,content:d,doc_type:"TEXT"}))}a&&(null==u||u(i,null==s?void 0:s[1])),(null===(t=s[2])||void 0===t?void 0:t.success)&&(null==y||y(!1),null==Z||Z())},P=()=>{let e=w.getFieldsValue().originFileObj;return!!e&&(x.ZP.warning(N("Limit_Upload_File_Count_Tips")),h.default.LIST_IGNORE)},S=[{type:"text",title:N("Text"),subTitle:N("Fill your raw text"),iconType:"TEXT"},{type:"webPage",title:N("URL"),subTitle:N("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"file",title:N("Document"),subTitle:N("Upload_a_document"),iconType:"DOCUMENT"}],v=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Item,{label:"".concat(N("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:N("Please_input_the_text_source")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:N("Please_input_the_text_source")})}),(0,s.jsx)(o.Z.Item,{label:"".concat(N("Text"),":"),name:"text",rules:[{required:!0,message:N("Please_input_the_description")}],children:(0,s.jsx)(k,{rows:4,maxLength:6})})]}),C=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(o.Z.Item,{label:"".concat(N("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:N("Please_input_the_owner")}],children:(0,s.jsx)(d.default,{className:"mb-5  h-12",placeholder:N("Please_input_the_Web_Page_URL")})})}),D=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(o.Z.Item,{name:"originFileObj",rules:[{required:!0,message:N("Please_input_the_owner")}],children:(0,s.jsxs)(g,{beforeUpload:P,multiple:!1,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(f.Z,{})}),(0,s.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:N("Select_or_Drop_file")}),(0,s.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})})});return a===b.ChooseType?(0,s.jsx)(s.Fragment,{children:S.map((e,l)=>(0,s.jsxs)(p.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{t(e)},children:[(0,s.jsxs)("div",{className:"font-semibold",children:[(0,j._)(e.iconType)," ",e.title]}),(0,s.jsx)("div",{children:e.subTitle})]},l))}):(0,s.jsxs)(o.Z,{form:w,size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:T,children:[(0,s.jsx)(o.Z.Item,{label:"".concat(N("Name"),":"),name:"documentName",rules:[{required:!0,message:N("Please_input_the_name")}],children:(0,s.jsx)(d.default,{className:"mb-5 h-12",placeholder:N("Please_input_the_name")})}),(()=>{switch(l){case"webPage":return C();case"file":return D();default:return v()}})(),(0,s.jsx)(o.Z.Item,{label:"".concat(N("Synch"),":"),name:"synchChecked",initialValue:!0,children:(0,s.jsx)(_.Z,{className:"bg-slate-400",defaultChecked:!0})}),(0,s.jsxs)(o.Z.Item,{children:[(0,s.jsx)(m.ZP,{onClick:n,className:"mr-4",children:"".concat(N("Back"))}),(0,s.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:N("Finish")})]})]})}function y(e){let{setIsAddShow:t,isAddShow:l,type:c,knowLedge:o,fetchDocuments:d,fetchKnowledge:m,syncDocuments:h}=e,{t:x}=(0,r.$G)(),p=[{title:x("Knowledge_Space_Config")},{title:x("Choose_a_Datasource_type")},{title:x("Setup_the_Datasource")}],_=[{title:x("Choose_a_Datasource_type")},{title:x("Setup_the_Datasource")}],[j,f]=(0,a.useState)(""),[b,g]=(0,a.useState)(0),y=async()=>{g(1),null==m||m()},N=e=>{f(e.type),g("knowledge"===c?2:1)},w=()=>{g("knowledge"===c?1:0)};return(0,s.jsxs)(n.default,{title:"knowledge"===c?"Add Knowledge":"Add Datasource",centered:!0,open:l,destroyOnClose:!0,onCancel:()=>{t(!1)},width:1e3,afterClose:()=>{g(0)},footer:null,children:[(0,s.jsx)(i.Z,{current:b,items:"knowledge"===c?p:_}),(()=>{let t="document"===c?b+1:b;return 0===t?(0,s.jsx)(u,{handleAddKnowledge:y}):(0,s.jsx)(Z,{fetchDocuments:d,knowledgeName:null==o?void 0:o.name,step:t,documentType:j,handleChooseType:N,handleBackBtn:w,syncDocuments:h,setIsAddShow:e.setIsAddShow})})()]})}},92039:function(e,t,l){l.d(t,{Z:function(){return O},_:function(){return V}});var s=l(85893),a=l(67294),n=l(12069),i=l(83062),r=l(66309),c=l(85813),o=l(32983),d=l(71577),m=l(42075),u=l(96074),h=l(75081),x=l(27595),p=l(27329),_=l(68346),j=l(21640),f=l(31326),b=l(88008),g=l(27704),Z=l(24969),y=l(18754),N=l(50489),w=l(30381),k=l.n(w),T=l(78543),P=l(59566),S=l(71230),v=l(15746),C=l(39479),D=l(44442),I=l(67421),F=l(31545),E=l(6321);let{TextArea:A}=P.default;function z(e){let{knowledge:t,argumentsShow:l,setArgumentsShow:i}=e,{t:r}=(0,I.$G)(),[c,o]=(0,a.useState)(),m=async()=>{let[e,l]=await (0,N.Vx)((0,N.Tu)(t.name));o(l)};(0,a.useEffect)(()=>{m()},[]);let u=[{key:"Embedding",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(F.Z,{}),r("Embedding")]}),children:(0,s.jsxs)(S.Z,{gutter:24,children:[(0,s.jsx)(v.Z,{span:12,offset:0,children:(0,s.jsx)(C.Z.Item,{tooltip:r("the_top_k_vectors"),rules:[{required:!0}],label:r("topk"),name:["embedding","topk"],children:(0,s.jsx)(P.default,{className:"mb-5 h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:r("Set_a_threshold_score"),rules:[{required:!0}],label:r("recall_score"),name:["embedding","recall_score"],children:(0,s.jsx)(P.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_owner")})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:r("Recall_Type"),rules:[{required:!0}],label:r("recall_type"),name:["embedding","recall_type"],children:(0,s.jsx)(P.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:r("A_model_used"),rules:[{required:!0}],label:r("model"),name:["embedding","model"],children:(0,s.jsx)(P.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:r("The_size_of_the_data_chunks"),rules:[{required:!0}],label:r("chunk_size"),name:["embedding","chunk_size"],children:(0,s.jsx)(P.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(v.Z,{span:12,children:(0,s.jsx)(C.Z.Item,{tooltip:r("The_amount_of_overlap"),rules:[{required:!0}],label:r("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,s.jsx)(P.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(E.Z,{}),r("Embedding")]}),children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z.Item,{tooltip:r("A_contextual_parameter"),label:r("scene"),name:["prompt","scene"],children:(0,s.jsx)(A,{rows:4,className:"mb-2"})}),(0,s.jsx)(C.Z.Item,{tooltip:r("structure_or_format"),label:r("template"),name:["prompt","template"],children:(0,s.jsx)(A,{rows:7,className:"mb-2"})}),(0,s.jsx)(C.Z.Item,{tooltip:r("The_maximum_number_of_tokens"),label:r("max_token"),name:["prompt","max_token"],children:(0,s.jsx)(P.default,{className:"mb-2"})})]})}],h=async e=>{let[l,s,a]=await (0,N.Vx)((0,N.iH)(t.name,{argument:JSON.stringify(e)}));(null==a?void 0:a.success)&&i(!1)};return(0,s.jsx)(n.default,{width:850,open:l,onCancel:()=>{i(!1)},footer:null,children:(0,s.jsxs)(C.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...c},autoComplete:"off",onFinish:h,children:[(0,s.jsx)(D.Z,{items:u}),(0,s.jsxs)("div",{className:"mt-3 mb-3",children:[(0,s.jsx)(d.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:r("Submit")}),(0,s.jsx)(d.ZP,{onClick:()=>{i(!1)},children:r("close")})]})]})})}var U=l(11163);let{confirm:q}=n.default,V=e=>"TEXT"===e?(0,s.jsx)(x.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===e?(0,s.jsx)(p.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,s.jsx)(_.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"});function O(e){let{t}=(0,I.$G)(),l=(0,U.useRouter)(),{knowledge:n,setDocumentCount:x}=e,[p,_]=(0,a.useState)(!1),[w,P]=(0,a.useState)([]),[S,v]=(0,a.useState)(!1),[C,D]=(0,a.useState)(!1),F=e=>{q({title:t("Tips"),icon:(0,s.jsx)(j.Z,{}),content:"".concat(t("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await O(e)}})};async function E(){_(!0);let[e,t]=await (0,N.Vx)((0,N._Q)(null==n?void 0:n.name,{page:1,page_size:20}));P(null==t?void 0:t.data),x(String(null==t?void 0:t.total)),_(!1)}let A=async(e,t)=>{await (0,N.Vx)((0,N.Hx)(e,{doc_ids:[t]}))},O=async e=>{await (0,N.Vx)((0,N.n3)(null==n?void 0:n.name,{doc_name:e.doc_name})),E()},L=()=>{v(!0)},G=(e,t)=>{let l;switch(e){case"TODO":l="gold";break;case"RUNNING":l="#2db7f5";break;case"FINISHED":l="#87d068";break;default:l="f50"}return(0,s.jsx)(i.Z,{title:t,children:(0,s.jsx)(r.Z,{color:l,children:e})})};return(0,a.useEffect)(()=>{E()},[n]),(0,s.jsxs)("div",{className:"collapse-container pt-2 px-4",children:[(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(d.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,s.jsx)(Z.Z,{}),onClick:L,children:t("Add_Datasource")}),(0,s.jsx)(d.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,s.jsx)(y.Z,{}),onClick:()=>{D(!0)},children:"Arguments"})]}),(0,s.jsx)(u.Z,{}),(0,s.jsx)(h.Z,{spinning:p,children:w.length>0?(0,s.jsx)("div",{className:"max-h-96 mt-3 grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-5 overflow-auto",children:w.map(e=>(0,s.jsxs)(c.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full",title:(0,s.jsx)(i.Z,{title:e.doc_name,children:(0,s.jsxs)("div",{className:"truncate ",children:[V(e.doc_type),(0,s.jsx)("span",{children:e.doc_name})]})}),extra:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(i.Z,{title:"detail",children:(0,s.jsx)(f.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{l.push("/knowledge/".concat(n.name,"/").concat(e.id))}})}),(0,s.jsx)(i.Z,{title:"Sync",children:(0,s.jsx)(b.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{A(n.name,e.id)}})}),(0,s.jsx)(i.Z,{title:"Delete",children:(0,s.jsx)(g.Z,{className:"text-[#ff1b2e] !text-lg",onClick:()=>{F(e)}})})]}),children:[(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Size"),":"]}),(0,s.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Last_Synch"),":"]}),(0,s.jsx)("p",{children:k()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,s.jsx)("p",{className:"mt-2 mb-2",children:G(e.status,e.result)})]},e.id))}):(0,s.jsx)(o.Z,{image:o.Z.PRESENTED_IMAGE_DEFAULT,children:(0,s.jsx)(d.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,s.jsx)(Z.Z,{}),onClick:L,children:"Create Now"})})}),(0,s.jsx)(T.Z,{syncDocuments:A,fetchDocuments:E,setIsAddShow:v,isAddShow:S,type:"document",setDocuments:P,knowLedge:n}),(0,s.jsx)(z,{knowledge:n,argumentsShow:C,setArgumentsShow:D})]})}}}]);